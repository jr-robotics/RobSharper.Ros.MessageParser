image: microsoft/dotnet:latest

stages:
  - publish
  - build
  - test

before_script:
  - export X_CI_VERSION=$(git describe)
##  - dotnet restore

build:
  stage: build
  script:
    - "dotnet build"
  tags:
    - docker-executor

test:
  stage: test
  script:
    - "dotnet test /p:CollectCoverage=true /p:Exclude=\"[xunit*]*\""
  tags:
    - docker-executor

nuget-pack:
  stage: publish
  script:
    - echo $X_CI_VERSION
    - cd Joanneum.Robotics.Ros.MessageParser
    - dotnet pack -c Release -o bin/nuget
  artifacts:
    paths:
      - Joanneum.Robotics.Ros.MessageParser/bin/nuget/
  tags:
    - docker-executor